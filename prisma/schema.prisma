generator client {
  provider        = "prisma-client-js"
  output          = "../src/generated/prisma"
  previewFeatures = ["partialIndexes"]
}

datasource db {
  provider = "postgresql"
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model categories {
  id               String       @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  parent_id        String?      @db.Uuid
  name             String
  slug             String       @unique
  description      String?
  image_path       String?
  display_order    Int?         @default(0)
  is_visible       Boolean?     @default(true)
  product_count    Int?         @default(0)
  seo_title        String?
  seo_description  String?
  created_at       DateTime     @default(now()) @db.Timestamptz(6)
  updated_at       DateTime     @default(now()) @db.Timestamptz(6)
  categories       categories?  @relation("categoriesTocategories", fields: [parent_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  other_categories categories[] @relation("categoriesTocategories")
  products         products[]

  @@index([parent_id], map: "idx_categories_parent_id")
  @@index([slug], map: "idx_categories_slug")
  @@index([is_visible, display_order], map: "idx_categories_visible")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
/// This model contains an expression index which requires additional setup for migrations. Visit https://pris.ly/d/expression-indexes for more info.
model discount_codes {
  id                   String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  code                 String            @unique
  type                 String
  value                Decimal           @db.Decimal(10, 2)
  minimum_order_amount Decimal?          @default(0) @db.Decimal(10, 2)
  usage_limit          Int?
  usage_count          Int?              @default(0)
  is_active            Boolean?          @default(true)
  valid_from           DateTime?         @default(now()) @db.Timestamptz(6)
  valid_until          DateTime?         @db.Timestamptz(6)
  created_at           DateTime          @default(now()) @db.Timestamptz(6)
  updated_at           DateTime          @default(now()) @db.Timestamptz(6)
  discount_usages      discount_usages[]

  @@index([is_active, valid_from, valid_until], map: "idx_discount_codes_active")
  @@index([code], map: "idx_discount_codes_code")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model discount_usages {
  id               String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  discount_code_id String         @db.Uuid
  order_id         String         @db.Uuid
  discount_applied Decimal        @db.Decimal(10, 2)
  created_at       DateTime       @default(now()) @db.Timestamptz(6)
  discount_codes   discount_codes @relation(fields: [discount_code_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  orders           orders         @relation(fields: [order_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([discount_code_id, order_id])
  @@index([discount_code_id], map: "idx_discount_usages_discount_code")
  @@index([order_id], map: "idx_discount_usages_order")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model email_logs {
  id              String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  order_id        String?   @db.Uuid
  email_type      String
  recipient_email String
  status          String?   @default("pending")
  resend_id       String?
  error_message   String?
  sent_at         DateTime? @db.Timestamptz(6)
  created_at      DateTime  @default(now()) @db.Timestamptz(6)
  orders          orders?   @relation(fields: [order_id], references: [id], onUpdate: NoAction)

  @@index([order_id], map: "idx_email_logs_order_id")
  @@index([status], map: "idx_email_logs_status")
  @@index([email_type, created_at(sort: Desc)], map: "idx_email_logs_type")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model homepage_config {
  id                String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  hero_headline     String?  @default("Transform Your Walls")
  hero_subheadline  String?  @default("Precision-crafted laser-cut metal art")
  hero_cta_text     String?  @default("Shop Now")
  hero_cta_link     String?  @default("/products")
  hero_image_path   String?
  promo_is_active   Boolean? @default(false)
  promo_headline    String?
  promo_subheadline String?
  promo_cta_text    String?
  promo_cta_link    String?
  promo_bg_color    String?  @default("#000000")
  created_at        DateTime @default(now()) @db.Timestamptz(6)
  updated_at        DateTime @default(now()) @db.Timestamptz(6)
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model inventory {
  id                  String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  variant_id          String           @unique @db.Uuid
  quantity_on_hand    Int?             @default(0)
  quantity_reserved   Int?             @default(0)
  quantity_available  Int?             @default(dbgenerated("(quantity_on_hand - quantity_reserved)"))
  low_stock_threshold Int?             @default(5)
  allow_backorder     Boolean?         @default(false)
  created_at          DateTime         @default(now()) @db.Timestamptz(6)
  updated_at          DateTime         @default(now()) @db.Timestamptz(6)
  product_variants    product_variants @relation(fields: [variant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([variant_id], map: "idx_inventory_low_stock", where: raw("(quantity_available <= low_stock_threshold)"))
  @@index([variant_id], map: "idx_inventory_variant_id")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model inventory_transactions {
  id               String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  variant_id       String           @db.Uuid
  type             String
  quantity_delta   Int
  quantity_before  Int
  quantity_after   Int
  reference_type   String?
  reference_id     String?          @db.Uuid
  notes            String?
  created_at       DateTime         @default(now()) @db.Timestamptz(6)
  product_variants product_variants @relation(fields: [variant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([reference_type, reference_id], map: "idx_inventory_transactions_reference")
  @@index([type, created_at(sort: Desc)], map: "idx_inventory_transactions_type")
  @@index([variant_id, created_at(sort: Desc)], map: "idx_inventory_transactions_variant")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
/// This model contains an expression index which requires additional setup for migrations. Visit https://pris.ly/d/expression-indexes for more info.
model newsletter_subscribers {
  id              String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  email           String    @unique
  is_active       Boolean?  @default(true)
  subscribed_at   DateTime  @default(now()) @db.Timestamptz(6)
  unsubscribed_at DateTime? @db.Timestamptz(6)

  @@index([is_active], map: "idx_newsletter_subscribers_active")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model order_items {
  id                  String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  order_id            String            @db.Uuid
  variant_id          String?           @db.Uuid
  product_name        String
  variant_description String?
  sku                 String
  quantity            Int
  unit_price          Decimal           @db.Decimal(10, 2)
  total_price         Decimal           @db.Decimal(10, 2)
  created_at          DateTime          @default(now()) @db.Timestamptz(6)
  orders              orders            @relation(fields: [order_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  product_variants    product_variants? @relation(fields: [variant_id], references: [id], onUpdate: NoAction)

  @@index([order_id], map: "idx_order_items_order_id")
  @@index([variant_id], map: "idx_order_items_variant_id")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model order_status_history {
  id              String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  order_id        String   @db.Uuid
  from_status     String?
  to_status       String
  changed_by_type String?  @default("system")
  notes           String?
  created_at      DateTime @default(now()) @db.Timestamptz(6)
  orders          orders   @relation(fields: [order_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([order_id, created_at(sort: Desc)], map: "idx_order_status_history_order_id")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model orders {
  id                   String                 @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  order_number         String                 @unique
  status               String?                @default("pending")
  customer_email       String
  customer_name        String
  customer_phone       String
  shipping_address     Json
  billing_address      Json?
  subtotal             Decimal                @db.Decimal(10, 2)
  discount_amount      Decimal?               @default(0) @db.Decimal(10, 2)
  shipping_cost        Decimal?               @default(0) @db.Decimal(10, 2)
  tax_amount           Decimal?               @default(0) @db.Decimal(10, 2)
  total_amount         Decimal                @db.Decimal(10, 2)
  currency             String                 @default("PKR")
  payment_status       String?                @default("pending")
  payment_intent_id    String?                @unique
  payment_method       String?
  notes                String?
  ip_address           String?
  user_agent           String?
  confirmed_at         DateTime?              @db.Timestamptz(6)
  shipped_at           DateTime?              @db.Timestamptz(6)
  delivered_at         DateTime?              @db.Timestamptz(6)
  cancelled_at         DateTime?              @db.Timestamptz(6)
  created_at           DateTime               @default(now()) @db.Timestamptz(6)
  updated_at           DateTime               @default(now()) @db.Timestamptz(6)
  discount_usages      discount_usages[]
  email_logs           email_logs[]
  order_items          order_items[]
  order_status_history order_status_history[]
  payments             payments[]
  refunds              refunds[]
  reviews              reviews[]

  @@index([created_at(sort: Desc)], map: "idx_orders_created_at")
  @@index([customer_email], map: "idx_orders_customer_email")
  @@index([order_number], map: "idx_orders_order_number")
  @@index([payment_intent_id], map: "idx_orders_payment_intent_id")
  @@index([status], map: "idx_orders_status")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model payments {
  id                       String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  order_id                 String    @db.Uuid
  stripe_payment_intent_id String    @unique
  amount                   Decimal   @db.Decimal(10, 2)
  currency                 String    @default("PKR")
  status                   String?   @default("pending")
  payment_method_type      String?
  payment_method_details   Json?
  stripe_metadata          Json?
  error_message            String?
  created_at               DateTime  @default(now()) @db.Timestamptz(6)
  updated_at               DateTime  @default(now()) @db.Timestamptz(6)
  orders                   orders    @relation(fields: [order_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  refunds                  refunds[]

  @@index([order_id], map: "idx_payments_order_id")
  @@index([status], map: "idx_payments_status")
  @@index([stripe_payment_intent_id], map: "idx_payments_stripe_payment_intent")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model product_attribute_values {
  id                                                                       String             @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  attribute_id                                                             String             @db.Uuid
  value                                                                    String
  display_name                                                             String
  display_order                                                            Int?               @default(0)
  created_at                                                               DateTime           @default(now()) @db.Timestamptz(6)
  product_attributes                                                       product_attributes @relation(fields: [attribute_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  product_variants_product_variants_material_idToproduct_attribute_values  product_variants[] @relation("product_variants_material_idToproduct_attribute_values")
  product_variants_product_variants_size_idToproduct_attribute_values      product_variants[] @relation("product_variants_size_idToproduct_attribute_values")
  product_variants_product_variants_thickness_idToproduct_attribute_values product_variants[] @relation("product_variants_thickness_idToproduct_attribute_values")

  @@unique([attribute_id, value])
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model product_attributes {
  id                       String                     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name                     String                     @unique
  display_name             String
  display_order            Int?                       @default(0)
  created_at               DateTime                   @default(now()) @db.Timestamptz(6)
  product_attribute_values product_attribute_values[]
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model product_images {
  id                String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  product_id        String            @db.Uuid
  variant_id        String?           @db.Uuid
  storage_path      String
  alt_text          String?
  display_order     Int?              @default(0)
  is_primary        Boolean?          @default(false)
  thumbnail_path    String?
  medium_path       String?
  large_path        String?
  processing_status String?           @default("pending")
  processing_error  String?
  blurhash          String?
  original_width    Int?
  original_height   Int?
  file_size_bytes   Int?
  created_at        DateTime          @default(now()) @db.Timestamptz(6)
  updated_at        DateTime          @default(now()) @db.Timestamptz(6)
  products          products          @relation(fields: [product_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  product_variants  product_variants? @relation(fields: [variant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([product_id], map: "idx_product_images_primary", where: raw("(is_primary = true)"))
  @@index([product_id, display_order], map: "idx_product_images_product_id")
  @@index([variant_id, display_order], map: "idx_product_images_variant_id")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model product_variants {
  id                                                                               String                   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  product_id                                                                       String                   @unique(map: "idx_product_variants_default", where: raw("(is_default = true)")) @db.Uuid
  sku                                                                              String                   @unique
  material_id                                                                      String                   @db.Uuid
  size_id                                                                          String                   @db.Uuid
  thickness_id                                                                     String                   @db.Uuid
  price                                                                            Decimal                  @db.Decimal(10, 2)
  compare_at_price                                                                 Decimal?                 @db.Decimal(10, 2)
  cost_per_item                                                                    Decimal?                 @db.Decimal(10, 2)
  is_default                                                                       Boolean?                 @default(false)
  created_at                                                                       DateTime                 @default(now()) @db.Timestamptz(6)
  updated_at                                                                       DateTime                 @default(now()) @db.Timestamptz(6)
  inventory                                                                        inventory?
  inventory_transactions                                                           inventory_transactions[]
  order_items                                                                      order_items[]
  product_images                                                                   product_images[]
  product_attribute_values_product_variants_material_idToproduct_attribute_values  product_attribute_values @relation("product_variants_material_idToproduct_attribute_values", fields: [material_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  products                                                                         products                 @relation(fields: [product_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  product_attribute_values_product_variants_size_idToproduct_attribute_values      product_attribute_values @relation("product_variants_size_idToproduct_attribute_values", fields: [size_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  product_attribute_values_product_variants_thickness_idToproduct_attribute_values product_attribute_values @relation("product_variants_thickness_idToproduct_attribute_values", fields: [thickness_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@unique([product_id, material_id, size_id, thickness_id])
  @@index([material_id], map: "idx_product_variants_material")
  @@index([price], map: "idx_product_variants_price")
  @@index([product_id], map: "idx_product_variants_product_id")
  @@index([size_id], map: "idx_product_variants_size")
  @@index([sku], map: "idx_product_variants_sku")
  @@index([thickness_id], map: "idx_product_variants_thickness")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model products {
  id               String             @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  category_id      String?            @db.Uuid
  name             String
  slug             String             @unique
  description      String?
  status           String?            @default("draft")
  is_featured      Boolean?           @default(false)
  featured_order   Int?               @default(0)
  total_sold       Int?               @default(0)
  view_count       Int?               @default(0)
  seo_title        String?
  seo_description  String?
  created_at       DateTime           @default(now()) @db.Timestamptz(6)
  updated_at       DateTime           @default(now()) @db.Timestamptz(6)
  product_images   product_images[]
  product_variants product_variants[]
  categories       categories?        @relation(fields: [category_id], references: [id], onUpdate: NoAction)
  reviews          reviews[]

  @@index([category_id], map: "idx_products_category_id")
  @@index([is_featured, featured_order], map: "idx_products_featured", where: raw("(is_featured = true)"))
  @@index([slug], map: "idx_products_slug")
  @@index([status], map: "idx_products_status")
  @@index([total_sold(sort: Desc)], map: "idx_products_total_sold")
  @@index([view_count(sort: Desc)], map: "idx_products_view_count")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model refunds {
  id               String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  order_id         String   @db.Uuid
  payment_id       String   @db.Uuid
  stripe_refund_id String   @unique
  amount           Decimal  @db.Decimal(10, 2)
  currency         String   @default("PKR")
  reason           String?
  status           String?  @default("pending")
  stripe_metadata  Json?
  notes            String?
  created_at       DateTime @default(now()) @db.Timestamptz(6)
  updated_at       DateTime @default(now()) @db.Timestamptz(6)
  orders           orders   @relation(fields: [order_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  payments         payments @relation(fields: [payment_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([order_id], map: "idx_refunds_order_id")
  @@index([payment_id], map: "idx_refunds_payment_id")
  @@index([stripe_refund_id], map: "idx_refunds_stripe_refund_id")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model reviews {
  id                   String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  product_id           String   @db.Uuid
  order_id             String?  @db.Uuid
  reviewer_name        String
  reviewer_email       String
  rating               Int
  title                String?
  body                 String?
  is_approved          Boolean? @default(false)
  is_verified_purchase Boolean? @default(false)
  helpful_count        Int?     @default(0)
  created_at           DateTime @default(now()) @db.Timestamptz(6)
  updated_at           DateTime @default(now()) @db.Timestamptz(6)
  orders               orders?  @relation(fields: [order_id], references: [id], onUpdate: NoAction)
  products             products @relation(fields: [product_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([product_id, reviewer_email])
  @@index([product_id, is_approved], map: "idx_reviews_product_approved", where: raw("(is_approved = true)"))
  @@index([product_id], map: "idx_reviews_product_id")
  @@index([product_id, rating], map: "idx_reviews_rating")
  @@index([product_id, is_verified_purchase], map: "idx_reviews_verified", where: raw("(is_verified_purchase = true)"))
}
